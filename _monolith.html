<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Identity Business Card Generator</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tabler-icons@1.74.0/tabler-sprite.svg" rel="stylesheet">
    <style>
        :root {
            --primary-color: #6366f1;
            --secondary-color: #8b5cf6;
            --accent-color: #06b6d4;
            --background-color: #f8fafc;
            --surface-color: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --border-radius: 12px;
            --shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            min-height: 100vh;
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 2rem;
            padding: 2rem;
        }

        @media (max-width: 1024px) {
            .container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }
        }

        .main-content {
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        .card {
            background: var(--surface-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            padding: 2rem;
        }

        .card-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .canvas-container {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            padding: 2rem;
            min-height: 400px;
        }

        #cardCanvas {
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            background: white;
            max-width: 100%;
            max-height: 100%;
        }

        .controls-panel {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 0.875rem;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .toggle-switch {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem 0;
        }

        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }

        .slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .slider {
            background-color: var(--primary-color);
        }

        input:checked + .slider:before {
            transform: translateX(26px);
        }

        .button {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            justify-content: center;
        }

        .button-primary {
            background: var(--primary-color);
            color: white;
        }

        .button-primary:hover {
            background: #5856eb;
            transform: translateY(-1px);
        }

        .button-secondary {
            background: var(--border-color);
            color: var(--text-primary);
        }

        .button-secondary:hover {
            background: #d1d5db;
        }

        .button-accent {
            background: var(--accent-color);
            color: white;
        }

        .button-accent:hover {
            background: #0891b2;
        }

        .button-group {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .color-palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .color-swatch {
            aspect-ratio: 1;
            border-radius: 8px;
            box-shadow: var(--shadow);
            cursor: pointer;
            transition: transform 0.2s;
            position: relative;
            overflow: hidden;
        }

        .color-swatch:hover {
            transform: scale(1.05);
        }

        .color-swatch .color-code {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 0.65rem;
            text-align: center;
            padding: 2px;
            font-family: 'Courier New', monospace;
        }

        .debug-console {
            background: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
            margin-top: 1rem;
        }

        .debug-console .debug-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
        }

        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 0.5rem;
        }

        .status-success { background: var(--success-color); }
        .status-warning { background: var(--warning-color); }
        .status-error { background: var(--error-color); }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .error-message {
            background: #fee2e2;
            color: #dc2626;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            border-left: 4px solid #dc2626;
        }

        .hidden {
            display: none;
        }

        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .dadaist-text {
            font-family: 'Roboto', sans-serif;
            font-weight: 300;
            letter-spacing: 0.5px;
        }

        .bilingual-text {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .bilingual-text .local {
            font-size: 0.9em;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .container {
                padding: 0.5rem;
            }
            
            .card {
                padding: 1rem;
            }
            
            .canvas-container {
                padding: 1rem;
                min-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="main-content">
            <div class="card">
                <div class="card-header">
                    <h1 class="card-title">Visual Identity Business Card Generator</h1>
                </div>
                
                <div class="canvas-container">
                    <canvas id="cardCanvas" width="856" height="540"></canvas>
                </div>
                
                <div class="debug-console">
                    <div class="debug-item">
                        <span>Screen Resolution:</span>
                        <span id="screenResolution">-</span>
                    </div>
                    <div class="debug-item">
                        <span>Device Type:</span>
                        <span id="deviceType">-</span>
                    </div>
                    <div class="debug-item">
                        <span>Orientation:</span>
                        <span id="currentOrientation">-</span>
                    </div>
                    <div class="debug-item">
                        <span>Card Standard:</span>
                        <span id="cardStandard">-</span>
                    </div>
                    <div class="debug-item">
                        <span>WCAG Compliance:</span>
                        <span id="wcagStatus">-</span>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Export Options</h2>
                </div>
                
                <div class="export-options">
                    <button class="button button-primary" onclick="exportCard('pdf')">
                        Export PDF
                    </button>
                    <button class="button button-secondary" onclick="exportCard('png')">
                        Export PNG
                    </button>
                    <button class="button button-accent" onclick="exportCard('svg')">
                        Export SVG
                    </button>
                    <button class="button button-secondary" onclick="exportColorPalette()">
                        Export Palette
                    </button>
                </div>
                
                <div class="form-group">
                    <label for="dpiSelect">Export DPI:</label>
                    <select id="dpiSelect">
                        <option value="300">300 DPI</option>
                        <option value="600">600 DPI</option>
                        <option value="1200">1200 DPI</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="controls-panel">
            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Card Settings</h2>
                </div>
                
                <div class="form-group">
                    <label for="cardStandardSelect">Card Standard:</label>
                    <select id="cardStandardSelect" onchange="updateCardStandard()">
                        <option value="ISO-7810">ISO-7810/ID-1 (85.60 √ó 53.98 mm)</option>
                        <option value="Indian">Indian Standard (55 √ó 90 mm)</option>
                    </select>
                </div>
                
                <div class="toggle-switch">
                    <label>Orientation:</label>
                    <div class="switch">
                        <input type="checkbox" id="orientationToggle" onchange="toggleOrientation()">
                        <span class="slider"></span>
                    </div>
                    <span id="orientationLabel">Landscape</span>
                </div>
                
                <div class="button-group">
                    <button class="button button-primary" onclick="randomizeCard()">
                        üé≤ Randomize
                    </button>
                    <button class="button button-secondary" onclick="generateCard()">
                        üé® Generate
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Contact Information</h2>
                </div>
                
                <div class="form-group">
                    <label for="nameEnglish">Name (English):</label>
                    <input type="text" id="nameEnglish" value="Arjun Patel" onchange="updateContactInfo()">
                </div>
                
                <div class="form-group">
                    <label for="nameLocal">Name (Local):</label>
                    <input type="text" id="nameLocal" value="‡§Ö‡§∞‡•ç‡§ú‡•Å‡§® ‡§™‡§ü‡•á‡§≤" onchange="updateContactInfo()">
                </div>
                
                <div class="form-group">
                    <label for="jobTitle">Job Title:</label>
                    <input type="text" id="jobTitle" value="Digital Designer" onchange="updateContactInfo()">
                </div>
                
                <div class="form-group">
                    <label for="phone">Phone:</label>
                    <input type="text" id="phone" value="+91-98765-43210" onchange="updateContactInfo()">
                </div>
                
                <div class="form-group">
                    <label for="email">Email:</label>
                    <input type="email" id="email" value="arjun.patel@example.com" onchange="updateContactInfo()">
                </div>
                
                <div class="form-group">
                    <label for="address">Address:</label>
                    <textarea id="address" rows="2" onchange="updateContactInfo()">Mumbai, Maharashtra, India</textarea>
                </div>
                
                <div class="form-group">
                    <label for="company">Company:</label>
                    <input type="text" id="company" value="Creative Studio" onchange="updateContactInfo()">
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Color Palette</h2>
                </div>
                
                <div class="color-palette" id="colorPalette">
                    <!-- Color swatches will be generated here -->
                </div>
                
                <div class="button-group">
                    <button class="button button-secondary" onclick="generateNewPalette()">
                        üé® New Palette
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Configuration</h2>
                </div>
                
                <div class="button-group">
                    <button class="button button-secondary" onclick="exportConfig()">
                        üíæ Export Config
                    </button>
                    <button class="button button-secondary" onclick="document.getElementById('configImport').click()">
                        üìÅ Import Config
                    </button>
                </div>
                
                <input type="file" id="configImport" accept=".json" style="display: none;" onchange="importConfig(event)">
            </div>
        </div>
    </div>

    <!-- Include required libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <script>
        // Global variables
        let currentConfig = {
            standard: 'ISO-7810',
            orientation: 'landscape',
            colors: [],
            contact: {
                nameEnglish: 'Arjun Patel',
                nameLocal: '‡§Ö‡§∞‡•ç‡§ú‡•Å‡§® ‡§™‡§ü‡•á‡§≤',
                jobTitle: 'Digital Designer',
                phone: '+91-98765-43210',
                email: 'arjun.patel@example.com',
                address: 'Mumbai, Maharashtra, India',
                company: 'Creative Studio'
            },
            logo: null,
            textures: []
        };

        const cardStandards = {
            'ISO-7810': { width: 85.60, height: 53.98, unit: 'mm' },
            'Indian': { width: 55, height: 90, unit: 'mm' }
        };

        const forbiddenColors = [
            '#000000', '#FFFFFF', '#FF0000', '#00FF00', 
            '#0000FF', '#FFFF00', '#FF00FF', '#00FFFF'
        ];

        let canvas, ctx;
        let deviceInfo = {};

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Check minimum requirements
            if (!checkMinimumRequirements()) {
                showError('Your screen resolution is too small. Minimum 320x568 required.');
                return;
            }

            // Initialize canvas
            canvas = document.getElementById('cardCanvas');
            ctx = canvas.getContext('2d');

            // Detect device information
            detectDevice();
            
            // Generate initial palette
            generateNewPalette();
            
            // Setup canvas
            setupCanvas();
            
            // Generate initial card
            generateCard();
            
            // Update debug console
            updateDebugConsole();
            
            // Setup orientation change listener
            window.addEventListener('orientationchange', handleOrientationChange);
            window.addEventListener('resize', handleOrientationChange);
        }

        function checkMinimumRequirements() {
            const minWidth = 320;
            const minHeight = 568;
            return window.screen.width >= minWidth && window.screen.height >= minHeight;
        }

        function detectDevice() {
            deviceInfo = {
                screenWidth: window.screen.width,
                screenHeight: window.screen.height,
                pixelRatio: window.devicePixelRatio || 1,
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                mobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),
                touchSupport: 'ontouchstart' in window,
                cores: navigator.hardwareConcurrency || 4,
                memory: navigator.deviceMemory || 4
            };

            // Detect device type
            if (deviceInfo.mobile) {
                deviceInfo.type = 'Mobile';
            } else if (window.screen.width <= 1024) {
                deviceInfo.type = 'Tablet';
            } else {
                deviceInfo.type = 'Desktop';
            }
        }

        function setupCanvas() {
            const standard = cardStandards[currentConfig.standard];
            const dpi = 300;
            
            if (currentConfig.orientation === 'landscape') {
                canvas.width = mmToPx(standard.width, dpi);
                canvas.height = mmToPx(standard.height, dpi);
            } else {
                canvas.width = mmToPx(standard.height, dpi);
                canvas.height = mmToPx(standard.width, dpi);
            }
            
            // Scale canvas for display
            const maxWidth = Math.min(600, window.innerWidth - 100);
            const scale = maxWidth / canvas.width;
            canvas.style.width = canvas.width * scale + 'px';
            canvas.style.height = canvas.height * scale + 'px';
        }

        function mmToPx(mm, dpi) {
            return Math.round((mm * dpi) / 25.4);
        }

        function generateNewPalette() {
            currentConfig.colors = [];
            for (let i = 0; i < 8; i++) {
                let color;
                do {
                    color = generateRandomColor();
                } while (isPureForbiddenColor(color));
                currentConfig.colors.push(color);
            }
            displayColorPalette();
        }

        function generateRandomColor() {
            const hue = Math.floor(Math.random() * 360);
            const saturation = Math.floor(Math.random() * 40) + 40; // 40-80%
            const lightness = Math.floor(Math.random() * 40) + 30; // 30-70%
            return hslToHex(hue, saturation, lightness);
        }

        function isPureForbiddenColor(color) {
            return forbiddenColors.includes(color.toUpperCase());
        }

        function hslToHex(h, s, l) {
            l /= 100;
            const a = s * Math.min(l, 1 - l) / 100;
            const f = n => {
                const k = (n + h / 30) % 12;
                const color = l - a * Math.max(Math.min(k - 3, 9 - k, 1), -1);
                return Math.round(255 * color).toString(16).padStart(2, '0');
            };
            return `#${f(0)}${f(8)}${f(4)}`;
        }

        function displayColorPalette() {
            const paletteContainer = document.getElementById('colorPalette');
            paletteContainer.innerHTML = '';
            
            currentConfig.colors.forEach((color, index) => {
                const swatch = document.createElement('div');
                swatch.className = 'color-swatch';
                swatch.style.backgroundColor = color;
                swatch.innerHTML = `<div class="color-code">${color}</div>`;
                swatch.onclick = () => selectColor(color, index);
                paletteContainer.appendChild(swatch);
            });
        }

        function selectColor(color, index) {
            console.log(`Selected color ${index}: ${color}`);
            // Could implement color editing here
        }

        function generateCard() {
            if (!ctx) return;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background
            drawBackground();
            
            // Draw dadaist elements
            drawDadaistElements();
            
            // Draw company logo area
            drawLogoArea();
            
            // Draw contact information
            drawContactInfo();
            
            // Draw decorative elements
            drawDecorations();
            
            // Update debug console
            updateDebugConsole();
        }

        function drawBackground() {
            const colors = currentConfig.colors;
            if (colors.length < 2) return;
            
            // Create gradient background
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, colors[0]);
            gradient.addColorStop(0.5, colors[1]);
            gradient.addColorStop(1, colors[2] || colors[0]);
            
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }

        function drawDadaistElements() {
            const colors = currentConfig.colors;
            if (colors.length < 4) return;
            
            // Draw random geometric shapes
            for (let i = 0; i < 5; i++) {
                ctx.save();
                ctx.globalAlpha = 0.3;
                ctx.fillStyle = colors[i % colors.length];
                
                const x = Math.random() * canvas.width;
                const y = Math.random() * canvas.height;
                const size = Math.random() * 100 + 20;
                
                if (Math.random() > 0.5) {
                    // Draw circle
                    ctx.beginPath();
                    ctx.arc(x, y, size, 0, Math.PI * 2);
                    ctx.fill();
                } else {
                    // Draw rectangle
                    ctx.fillRect(x, y, size, size);
                }
                
                ctx.restore();
            }
        }

        function drawLogoArea() {
            const colors = currentConfig.colors;
            if (colors.length < 3) return;
            
            // Draw logo placeholder
            const logoSize = Math.min(canvas.width, canvas.height) * 0.2;
            const logoX = canvas.width * 0.05;
            const logoY = canvas.height * 0.05;
            
            ctx.fillStyle = colors[3];
            ctx.fillRect(logoX, logoY, logoSize, logoSize);
            
            // Draw logo text
            ctx.fillStyle = getContrastColor(colors[3]);
            ctx.font = `${logoSize * 0.15}px Inter`;
            ctx.textAlign = 'center';
            ctx.fillText('LOGO', logoX + logoSize / 2, logoY + logoSize / 2);
        }

        function drawContactInfo() {
            const colors = currentConfig.colors;
            const contact = currentConfig.contact;
            
            // Calculate text area
            const textX = canvas.width * 0.35;
            const textY = canvas.height * 0.15;
            const textWidth = canvas.width * 0.6;
            
            // Draw semi-transparent background for text
            ctx.fillStyle = 'rgba(255, 255, 255, 0.9)';
            ctx.fillRect(textX - 10, textY - 10, textWidth + 20, canvas.height * 0.7);
            
            // Draw text
            ctx.fillStyle = colors[4] || '#333333';
            ctx.textAlign = 'left';
            
            let currentY = textY + 20;
            const lineHeight = canvas.height * 0.08;
            
            // Name (English)
            ctx.font = `bold ${lineHeight * 0.7}px Inter`;
            ctx.fillText(contact.nameEnglish, textX, currentY);
            currentY += lineHeight * 0.5;
            
            // Name (Local)
            ctx.font = `${lineHeight * 0.5}px Inter`;
            ctx.fillStyle = colors[5] || '#666666';
            ctx.fillText(contact.nameLocal, textX, currentY);
            currentY += lineHeight;
            
            // Job Title
            ctx.font = `${lineHeight * 0.4}px Inter`;
            ctx.fillStyle = colors[6] || '#555555';
            ctx.fillText(contact.jobTitle, textX, currentY);
            currentY += lineHeight * 0.8;
            
            // Contact details
            ctx.font = `${lineHeight * 0.35}px Inter`;
            ctx.fillStyle = colors[7] || '#444444';
            ctx.fillText(contact.phone, textX, currentY);
            currentY += lineHeight * 0.6;
            ctx.fillText(contact.email, textX, currentY);
            currentY += lineHeight * 0.6;
            ctx.fillText(contact.address, textX, currentY);
            currentY += lineHeight * 0.6;
            ctx.fillText(contact.company, textX, currentY);
        }

        function drawDecorations() {
            const colors = currentConfig.colors;
            
            // Draw decorative border
            ctx.strokeStyle = colors[0];
            ctx.lineWidth = 3;
            ctx.strokeRect(5, 5, canvas.width - 10, canvas.height - 10);
            
            // Draw corner decorations
            for (let i = 0; i < 4; i++) {
                const x = i % 2 === 0 ? 20 : canvas.width - 20;
                const y = i < 2 ? 20 : canvas.height - 20;
                
                ctx.fillStyle = colors[i % colors.length];
                ctx.beginPath();
                ctx.arc(x, y, 10, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function getContrastColor(hexColor) {
            const r = parseInt(hexColor.substr(1, 2), 16);
            const g = parseInt(hexColor.substr(3, 2), 16);
            const b = parseInt(hexColor.substr(5, 2), 16);
            const luminance = (0.299 * r + 0.587 * g + 0.114 * b) / 255;
            return luminance > 0.5 ? '#000000' : '#FFFFFF';
        }

        function calculateContrast(color1, color2) {
            const lum1 = getLuminance(color1);
            const lum2 = getLuminance(color2);
            const brightest = Math.max(lum1, lum2);
            const darkest = Math.min(lum1, lum2);
            return (brightest + 0.05) / (darkest + 0.05);
        }

        function getLuminance(color) {
            const rgb = hexToRgb(color);
            const [r, g, b] = rgb.map(c => {
                c = c / 255;
                return c <= 0.03928 ? c / 12.92 : Math.pow((c + 0.055) / 1.055, 2.4);
            });
            return 0.2126 * r + 0.7152 * g + 0.0722 * b;
        }

        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? [
                parseInt(result[1], 16),
                parseInt(result[2], 16),
                parseInt(result[3], 16)
            ] : null;
        }

        function updateCardStandard() {
            const select = document.getElementById('cardStandardSelect');
            currentConfig.standard = select.value;
            setupCanvas();
            generateCard();
        }

        function toggleOrientation() {
            const toggle = document.getElementById('orientationToggle');
            const label = document.getElementById('orientationLabel');
            
            if (toggle.checked) {
                currentConfig.orientation = 'portrait';
                label.textContent = 'Portrait';
            } else {
                currentConfig.orientation = 'landscape';
                label.textContent = 'Landscape';
            }
            
            setupCanvas();
            generateCard();
        }

        function handleOrientationChange() {
            setTimeout(() => {
                detectDevice();
                setupCanvas();
                generateCard();
                updateDebugConsole();
            }, 100);
        }

        function updateContactInfo() {
            currentConfig.contact = {
                nameEnglish: document.getElementById('nameEnglish').value,
                nameLocal: document.getElementById('nameLocal').value,
                jobTitle: document.getElementById('jobTitle').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                address: document.getElementById('address').value,
                company: document.getElementById('company').value
            };
            generateCard();
        }

        function randomizeCard() {
            // Randomize colors
            generateNewPalette();
            
            // Randomize contact info with Indian names
            const indianNames = [
                { english: 'Arjun Patel', local: '‡§Ö‡§∞‡•ç‡§ú‡•Å‡§® ‡§™‡§ü‡•á‡§≤' },
                { english: 'Priya Sharma', local: '‡§™‡•ç‡§∞‡§ø‡§Ø‡§æ ‡§∂‡§∞‡•ç‡§Æ‡§æ' },
                { english: 'Kiran Kumar', local: '‡§ï‡§ø‡§∞‡§£ ‡§ï‡•Å‡§Æ‡§æ‡§∞' },
                { english: 'Anita Singh', local: '‡§Ö‡§®‡•Ä‡§§‡§æ ‡§∏‡§ø‡§Ç‡§π' },
                { english: 'Raj Gupta', local: '‡§∞‡§æ‡§ú ‡§ó‡•Å‡§™‡•ç‡§§‡§æ' },
                { english: 'Maya Joshi', local: '‡§Æ‡§æ‡§Ø‡§æ ‡§ú‡•ã‡§∂‡•Ä' }
            ];
            
            const jobTitles = [
                'Digital Designer', 'Software Engineer', 'Marketing Manager',
                'Creative Director', 'Data Analyst', 'Product Manager'
            ];
            
            const companies = [
                'Tech Solutions', 'Creative Studio', 'Digital Agency',
                'Innovation Labs', 'Design House', 'Tech Ventures'
            ];
            
            const cities = [
                'Mumbai, Maharashtra', 'Delhi, Delhi', 'Bangalore, Karnataka',
                'Chennai, Tamil Nadu', 'Pune, Maharashtra', 'Hyderabad, Telangana'
            ];
            
            const randomName = indianNames[Math.floor(Math.random() * indianNames.length)];
            const randomTitle = jobTitles[Math.floor(Math.random() * jobTitles.length)];
            const randomCompany = companies[Math.floor(Math.random() * companies.length)];
            const randomCity = cities[Math.floor(Math.random() * cities.length)];
            
            // Update form fields
            document.getElementById('nameEnglish').value = randomName.english;
            document.getElementById('nameLocal').value = randomName.local;
            document.getElementById('jobTitle').value = randomTitle;
            document.getElementById('company').value = randomCompany;
            document.getElementById('address').value = randomCity + ', India';
            
            // Update config
            updateContactInfo();
        }

        function updateDebugConsole() {
            document.getElementById('screenResolution').textContent = 
                `${deviceInfo.screenWidth}x${deviceInfo.screenHeight} (${deviceInfo.pixelRatio}x)`;
            document.getElementById('deviceType').textContent = deviceInfo.type;
            document.getElementById('currentOrientation').textContent = currentConfig.orientation;
            document.getElementById('cardStandard').textContent = currentConfig.standard;
            
            // Calculate WCAG compliance
            let wcagCompliant = 0;
            let totalChecks = 0;
            
            for (let i = 0; i < currentConfig.colors.length - 1; i++) {
                for (let j = i + 1; j < currentConfig.colors.length; j++) {
                    const contrast = calculateContrast(currentConfig.colors[i], currentConfig.colors[j]);
                    totalChecks++;
                    if (contrast >= 4.5) wcagCompliant++;
                }
            }
            
            const complianceRate = totalChecks > 0 ? (wcagCompliant / totalChecks * 100).toFixed(1) : 0;
            document.getElementById('wcagStatus').innerHTML = 
                `<span class="status-indicator ${complianceRate >= 70 ? 'status-success' : complianceRate >= 50 ? 'status-warning' : 'status-error'}"></span>${complianceRate}%`;
        }

        function exportCard(format) {
            const dpi = parseInt(document.getElementById('dpiSelect').value);
            
            switch (format.toLowerCase()) {
                case 'pdf':
                    exportToPDF();
                    break;
                case 'png':
                    exportToPNG(dpi);
                    break;
                case 'svg':
                    exportToSVG();
                    break;
            }
        }

        function exportToPDF() {
            const { jsPDF } = window.jspdf;
            const standard = cardStandards[currentConfig.standard];
            
            const orientation = currentConfig.orientation === 'landscape' ? 'l' : 'p';
            const pdf = new jsPDF({
                orientation: orientation,
                unit: 'mm',
                format: [standard.width, standard.height]
            });
            
            const imgData = canvas.toDataURL('image/png');
            if (currentConfig.orientation === 'landscape') {
                pdf.addImage(imgData, 'PNG', 0, 0, standard.width, standard.height);
            } else {
                pdf.addImage(imgData, 'PNG', 0, 0, standard.height, standard.width);
            }
            
            pdf.save('business-card.pdf');
        }

        function exportToPNG(dpi) {
            canvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `business-card-${dpi}dpi.png`;
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        function exportToSVG() {
            // For SVG export, we'll create a simple SVG representation
            const standard = cardStandards[currentConfig.standard];
            const width = currentConfig.orientation === 'landscape' ? standard.width : standard.height;
            const height = currentConfig.orientation === 'landscape' ? standard.height : standard.width;
            
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="${width}mm" height="${height}mm" viewBox="0 0 ${width} ${height}">
                    <rect width="100%" height="100%" fill="${currentConfig.colors[0] || '#ffffff'}"/>
                    <text x="10" y="20" font-family="Arial" font-size="4" fill="${currentConfig.colors[1] || '#000000'}">
                        ${currentConfig.contact.nameEnglish}
                    </text>
                    <text x="10" y="30" font-family="Arial" font-size="3" fill="${currentConfig.colors[2] || '#000000'}">
                        ${currentConfig.contact.jobTitle}
                    </text>
                </svg>
            `;
            
            const blob = new Blob([svg], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'business-card.svg';
            a.click();
            URL.revokeObjectURL(url);
        }

        function exportColorPalette() {
            const paletteCanvas = document.createElement('canvas');
            paletteCanvas.width = 800;
            paletteCanvas.height = 200;
            const paletteCtx = paletteCanvas.getContext('2d');
            
            const swatchWidth = 800 / currentConfig.colors.length;
            
            currentConfig.colors.forEach((color, index) => {
                const x = index * swatchWidth;
                
                // Draw color swatch
                paletteCtx.fillStyle = color;
                paletteCtx.fillRect(x, 0, swatchWidth, 150);
                
                // Draw hex code
                paletteCtx.fillStyle = getContrastColor(color);
                paletteCtx.font = '14px monospace';
                paletteCtx.textAlign = 'center';
                paletteCtx.fillText(color, x + swatchWidth / 2, 170);
            });
            
            paletteCanvas.toBlob((blob) => {
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'color-palette.png';
                a.click();
                URL.revokeObjectURL(url);
            }, 'image/png');
        }

        function exportConfig() {
            const config = {
                ...currentConfig,
                timestamp: new Date().toISOString(),
                version: '1.0'
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'business-card-config.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    currentConfig = { ...currentConfig, ...config };
                    
                    // Update form fields
                    document.getElementById('nameEnglish').value = currentConfig.contact.nameEnglish;
                    document.getElementById('nameLocal').value = currentConfig.contact.nameLocal;
                    document.getElementById('jobTitle').value = currentConfig.contact.jobTitle;
                    document.getElementById('phone').value = currentConfig.contact.phone;
                    document.getElementById('email').value = currentConfig.contact.email;
                    document.getElementById('address').value = currentConfig.contact.address;
                    document.getElementById('company').value = currentConfig.contact.company;
                    
                    // Update card standard
                    document.getElementById('cardStandardSelect').value = currentConfig.standard;
                    
                    // Update orientation
                    const orientationToggle = document.getElementById('orientationToggle');
                    orientationToggle.checked = currentConfig.orientation === 'portrait';
                    document.getElementById('orientationLabel').textContent = 
                        currentConfig.orientation === 'portrait' ? 'Portrait' : 'Landscape';
                    
                    // Regenerate card
                    displayColorPalette();
                    setupCanvas();
                    generateCard();
                    
                    alert('Configuration imported successfully!');
                } catch (error) {
                    alert('Error importing configuration: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function showError(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.body.prepend(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
    </script>
</body>
</html>